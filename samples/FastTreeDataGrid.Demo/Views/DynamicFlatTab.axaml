<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:FastTreeDataGrid.Demo.ViewModels"
             xmlns:crud="clr-namespace:FastTreeDataGrid.Demo.ViewModels.Crud"
             xmlns:controls="clr-namespace:FastTreeDataGrid.Control.Controls;assembly=FastTreeDataGrid.Control"
             xmlns:i="clr-namespace:Avalonia.Input;assembly=Avalonia.Base"
             mc:Ignorable="d"
             x:Class="FastTreeDataGrid.Demo.Views.DynamicFlatTab"
             x:Name="Root"
             x:DataType="vm:MainWindowViewModel">
  <Grid RowDefinitions="Auto,*"
        RowSpacing="12">
    <Grid.DataContext>
      <Binding Path="DynamicFlat" />
    </Grid.DataContext>
    <Border Grid.Row="0"
            Padding="12"
            Background="#F4FBFF"
            BorderBrush="#B9DFF3"
            BorderThickness="1"
            CornerRadius="6">
      <StackPanel Spacing="8">
        <TextBlock Text="Dynamic orders with periodic status and total updates."
                   FontWeight="SemiBold" />
        <StackPanel Orientation="Horizontal"
                    Spacing="6"
                    VerticalAlignment="Center">
          <TextBlock Text="New order:"
                     VerticalAlignment="Center" />
          <TextBox Width="220"
                   Watermark="Customer"
                   Text="{Binding NewOrderCustomer, UpdateSourceTrigger=PropertyChanged}" />
          <ComboBox Width="160"
                    ItemsSource="{Binding Statuses}"
                    SelectedItem="{Binding NewOrderStatus, Mode=TwoWay}" />
          <TextBox Width="120"
                   Watermark="Total"
                   Text="{Binding NewOrderTotalText, UpdateSourceTrigger=PropertyChanged}" />
          <Button Content="Add"
                  Command="{Binding AddOrderCommand}" />
        </StackPanel>
        <Border Padding="8"
                Background="#FFFFFF"
                BorderBrush="#CBE7F4"
                BorderThickness="1"
                CornerRadius="4">
          <StackPanel Spacing="6">
            <TextBlock Text="Edit selected order:" />
            <StackPanel Orientation="Horizontal"
                        Spacing="6">
              <TextBox Width="220"
                       Watermark="Customer"
                       Text="{Binding EditOrderCustomer, UpdateSourceTrigger=PropertyChanged}" />
              <ComboBox Width="160"
                        ItemsSource="{Binding Statuses}"
                        SelectedItem="{Binding EditOrderStatus, Mode=TwoWay}" />
              <TextBox Width="120"
                       Watermark="Total"
                       Text="{Binding EditOrderTotalText, UpdateSourceTrigger=PropertyChanged}" />
              <Button Content="Save changes"
                      Command="{Binding SaveOrderCommand}" />
              <Button Content="Delete"
                      Command="{Binding DeleteOrderCommand}" />
            </StackPanel>
          </StackPanel>
        </Border>
        <TextBlock Text="{Binding Status}"
                   Foreground="#1565C0" />
      </StackPanel>
    </Border>
    <Border Grid.Row="1"
            BorderBrush="#A9CFE7"
            BorderThickness="1"
            CornerRadius="6"
            Padding="0">
      <controls:FastTreeDataGrid x:Name="DynamicFlatGrid"
                                 ItemsSource="{Binding Source}"
                                 SelectedIndices="{Binding SelectedIndices, Mode=TwoWay}"
                                 RowHeight="30"
                                 HeaderHeight="34"
                                 IsFilterRowVisible="False"
                                 CellEditCommitted="OnDynamicFlatCellEditCommitted">
        <controls:FastTreeDataGrid.KeyBindings>
          <i:KeyBinding Gesture="Delete" Command="{Binding DeleteOrderCommand}" />
        </controls:FastTreeDataGrid.KeyBindings>
        <controls:FastTreeDataGrid.Columns>
          <FastTreeDataGridColumn Header="Order #"
                                  ValueKey="{x:Static crud:DynamicFlatRow.KeyOrder}"
                                  SizingMode="Pixel"
                                  PixelWidth="120"
                                  CanUserSort="False"
                                  IsReadOnly="True" />
          <FastTreeDataGridColumn Header="Customer"
                                  ValueKey="{x:Static crud:DynamicFlatRow.KeyCustomer}"
                                  SizingMode="Star"
                                  CanUserSort="False">
            <FastTreeDataGridColumn.EditTemplate>
              <DataTemplate x:DataType="crud:DynamicFlatRow">
                <TextBox Text="{Binding Customer, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         MinWidth="160" />
              </DataTemplate>
            </FastTreeDataGridColumn.EditTemplate>
          </FastTreeDataGridColumn>
          <FastTreeDataGridColumn Header="Status"
                                  ValueKey="{x:Static crud:DynamicFlatRow.KeyStatus}"
                                  SizingMode="Pixel"
                                  PixelWidth="150"
                                  CanUserSort="False">
            <FastTreeDataGridColumn.EditTemplate>
              <DataTemplate x:DataType="crud:DynamicFlatRow">
                <ComboBox ItemsSource="{Binding ElementName=Root, Path=((vm:MainWindowViewModel)DataContext).DynamicFlat.Statuses}"
                          SelectedItem="{Binding StatusText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                          MinWidth="140" />
              </DataTemplate>
            </FastTreeDataGridColumn.EditTemplate>
          </FastTreeDataGridColumn>
          <FastTreeDataGridColumn Header="Total"
                                  ValueKey="{x:Static crud:DynamicFlatRow.KeyTotal}"
                                  SizingMode="Pixel"
                                  PixelWidth="120"
                                  CanUserSort="False">
            <FastTreeDataGridColumn.EditTemplate>
              <DataTemplate x:DataType="crud:DynamicFlatRow">
                <TextBox Text="{Binding Total, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         HorizontalContentAlignment="Right"
                         MinWidth="100" />
              </DataTemplate>
            </FastTreeDataGridColumn.EditTemplate>
          </FastTreeDataGridColumn>
          <FastTreeDataGridColumn Header="Last Updated"
                                  ValueKey="{x:Static crud:DynamicFlatRow.KeyUpdated}"
                                  SizingMode="Pixel"
                                  PixelWidth="160"
                                  CanUserSort="False"
                                  IsReadOnly="True" />
        </controls:FastTreeDataGrid.Columns>
      </controls:FastTreeDataGrid>
    </Border>
  </Grid>
</UserControl>
