<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:FastTreeDataGrid.Demo.ViewModels"
             xmlns:crud="clr-namespace:FastTreeDataGrid.Demo.ViewModels.Crud"
             xmlns:controls="clr-namespace:FastTreeDataGrid.Control.Controls;assembly=FastTreeDataGrid.Control"
             xmlns:i="clr-namespace:Avalonia.Input;assembly=Avalonia.Base"
             mc:Ignorable="d"
             x:Class="FastTreeDataGrid.Demo.Views.DynamicHierarchyTab"
             x:DataType="vm:MainWindowViewModel">
  <Grid RowDefinitions="Auto,*"
        RowSpacing="12">
    <Grid.DataContext>
      <Binding Path="DynamicHierarchy" />
    </Grid.DataContext>
    <Border Grid.Row="0"
            Padding="12"
            Background="#FFF8F4"
            BorderBrush="#F0C2A8"
            BorderThickness="1"
            CornerRadius="6">
      <StackPanel Spacing="8">
        <TextBlock Text="Dynamic in-memory projects with live task updates."
                   FontWeight="SemiBold" />
        <StackPanel Orientation="Horizontal"
                    Spacing="6"
                    VerticalAlignment="Center">
          <TextBlock Text="New project:"
                     VerticalAlignment="Center" />
          <TextBox Width="220"
                   Watermark="Project title"
                   Text="{Binding NewProjectName, UpdateSourceTrigger=PropertyChanged}" />
          <TextBox Width="160"
                   Watermark="Owner"
                   Text="{Binding NewProjectOwner, UpdateSourceTrigger=PropertyChanged}" />
          <Button Content="Add"
                  Command="{Binding AddProjectCommand}" />
        </StackPanel>
        <StackPanel Orientation="Horizontal"
                    Spacing="6"
                    VerticalAlignment="Center">
          <TextBlock Text="New task:"
                     VerticalAlignment="Center" />
          <TextBox Width="220"
                   Watermark="Task title"
                   Text="{Binding NewTaskName, UpdateSourceTrigger=PropertyChanged}" />
          <TextBox Width="160"
                   Watermark="Owner"
                   Text="{Binding NewTaskOwner, UpdateSourceTrigger=PropertyChanged}" />
          <StackPanel Orientation="Horizontal"
                      Spacing="4"
                      VerticalAlignment="Center">
            <TextBlock Text="Progress"
                       VerticalAlignment="Center" />
            <Slider Width="140"
                    Minimum="0"
                    Maximum="100"
                    Value="{Binding NewTaskProgress, Mode=TwoWay}" />
          </StackPanel>
          <Button Content="Add to selection"
                  Command="{Binding AddTaskCommand}" />
        </StackPanel>
        <Border Padding="8"
                Background="#FFFFFF"
                BorderBrush="#F3D9C3"
                BorderThickness="1"
                CornerRadius="4">
          <StackPanel Spacing="6">
            <TextBlock Text="{Binding SelectionSummary}" />
            <StackPanel Orientation="Horizontal"
                        Spacing="6">
              <TextBox Width="220"
                       Watermark="Name"
                       Text="{Binding EditName, UpdateSourceTrigger=PropertyChanged}" />
              <TextBox Width="160"
                       Watermark="Owner"
                       Text="{Binding EditOwner, UpdateSourceTrigger=PropertyChanged}" />
              <StackPanel Orientation="Horizontal"
                          Spacing="4"
                          VerticalAlignment="Center">
                <TextBlock Text="Progress"
                           VerticalAlignment="Center" />
                <Slider Width="140"
                        Minimum="0"
                        Maximum="100"
                        IsEnabled="{Binding IsTaskSelected}"
                        Value="{Binding EditProgress, Mode=TwoWay}" />
              </StackPanel>
              <Button Content="Save changes"
                      Command="{Binding SaveCommand}" />
              <Button Content="Delete"
                      Command="{Binding DeleteCommand}" />
            </StackPanel>
          </StackPanel>
        </Border>
        <TextBlock Text="{Binding Status}"
                   Foreground="#BA4A00" />
      </StackPanel>
    </Border>
    <Border Grid.Row="1"
            BorderBrush="#E8C0A7"
            BorderThickness="1"
            CornerRadius="6"
            Padding="0">
      <controls:FastTreeDataGrid x:Name="DynamicHierarchyGrid"
                                 ItemsSource="{Binding Source}"
                                 SelectedIndices="{Binding SelectedIndices, Mode=TwoWay}"
                                 RowHeight="30"
                                 IndentWidth="20"
                                 HeaderHeight="34"
                                 IsFilterRowVisible="False"
                                 CellEditCommitted="OnDynamicHierarchyCellEditCommitted">
        <controls:FastTreeDataGrid.KeyBindings>
          <i:KeyBinding Gesture="Delete" Command="{Binding DeleteCommand}" />
        </controls:FastTreeDataGrid.KeyBindings>
        <controls:FastTreeDataGrid.Columns>
          <FastTreeDataGridColumn Header="Name"
                                  ValueKey="{x:Static crud:DynamicCrudNode.KeyName}"
                                  SizingMode="Star"
                                  IsHierarchy="True"
                                  CanUserSort="False">
            <FastTreeDataGridColumn.EditTemplate>
              <DataTemplate x:DataType="crud:DynamicCrudNode">
                <TextBox Text="{Binding Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         MinWidth="160" />
              </DataTemplate>
            </FastTreeDataGridColumn.EditTemplate>
          </FastTreeDataGridColumn>
          <FastTreeDataGridColumn Header="Owner"
                                  ValueKey="{x:Static crud:DynamicCrudNode.KeyOwner}"
                                  SizingMode="Star"
                                  CanUserSort="False">
            <FastTreeDataGridColumn.EditTemplate>
              <DataTemplate x:DataType="crud:DynamicCrudNode">
                <TextBox Text="{Binding Owner, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         MinWidth="140" />
              </DataTemplate>
            </FastTreeDataGridColumn.EditTemplate>
          </FastTreeDataGridColumn>
          <FastTreeDataGridColumn Header="Type"
                                  ValueKey="{x:Static crud:DynamicCrudNode.KeyType}"
                                  SizingMode="Pixel"
                                  PixelWidth="140"
                                  CanUserSort="False" />
          <FastTreeDataGridColumn Header="Progress"
                                  ValueKey="{x:Static crud:DynamicCrudNode.KeyProgress}"
                                  SizingMode="Pixel"
                                  PixelWidth="140"
                                  CanUserSort="False">
            <FastTreeDataGridColumn.EditTemplate>
              <DataTemplate x:DataType="crud:DynamicCrudNode">
                <NumericUpDown Minimum="0"
                               Maximum="100"
                               Increment="1"
                               Value="{Binding Progress, Mode=TwoWay}"
                               Width="120" />
              </DataTemplate>
            </FastTreeDataGridColumn.EditTemplate>
          </FastTreeDataGridColumn>
        </controls:FastTreeDataGrid.Columns>
      </controls:FastTreeDataGrid>
    </Border>
  </Grid>
</UserControl>
